<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/svg+xml" href="/vite.svg" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Earth Login</title>
  <!-- Import Inter font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./style.css">
</head>

<body>
  <!-- Sound Check Overlay -->
  <div id="sound-check-overlay"
    style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 9999; background: #000; display: flex; flex-direction: column; justify-content: center; align-items: center; color: white; font-family: 'Inter', sans-serif;">
    <h1 style="font-size: 2rem; margin-bottom: 20px; font-weight: 300; letter-spacing: 2px;">AUDIO EXPERIENCE</h1>
    <p style="margin-bottom: 40px; color: #888;">Please turn on your speakers for the full experience.</p>
    <button id="sound-ready-btn"
      style="padding: 15px 40px; background: transparent; border: 1px solid #00A4EF; color: #00A4EF; font-size: 1.2rem; cursor: pointer; transition: all 0.3s; border-radius: 4px; text-transform: uppercase; letter-spacing: 2px;">
      Initialize System
    </button>
  </div>

  <!-- 3D Canvas will be injected here by main.js (or we can specify it) -->

  <!-- Login UI Overlay -->
  <div id="login-container">
    <div class="login-content" id="login-content">
      <div class="brand"><span class="brand-pink">good</span><span class="brand-blue">talent</span><span
          class="brand-dot">.</span></div>
      <h1>Welcome Back</h1>
      <p class="subtitle">Sign in to continue to your account</p>

      <form id="login-form">
        <div class="input-group">
          <label for="email">Email Address</label>
          <div class="input-wrapper">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
              stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="input-icon">
              <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
              <polyline points="22,6 12,13 2,6"></polyline>
            </svg>
            <input type="email" id="email" placeholder="Enter your email" required autocomplete="off">
          </div>
        </div>

        <div class="input-group">
          <label for="password">Password</label>
          <div class="input-wrapper">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
              stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="input-icon">
              <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
              <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
            </svg>
            <input type="password" id="password" placeholder="Enter your password" required>
          </div>
        </div>

        <button type="submit" class="login-btn">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"></path>
            <polyline points="10 17 15 12 10 7"></polyline>
            <line x1="15" y1="12" x2="3" y2="12"></line>
          </svg>
          <span>Sign In</span>
        </button>
      </form>
    </div>
  </div>

  <!-- Matrix Terminal Overlay -->
  <div id="terminal-overlay">
    <div class="terminal-window">
      <div id="terminal-content"></div>
    </div>
  </div>

  <!-- Video Overlay -->
  <div id="video-overlay"
    style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 2000; background: black; display: none; opacity: 0; transition: opacity 0.5s;">
    <video id="intro-video" style="width: 100%; height: 100%; object-fit: cover;">
      <source src="/intro.mp4" type="video/mp4">
    </video>
  </div>

  <!-- OS Loader -->
  <div id="os-loader">
    <div class="loader-content">
      <div class="loader-logo">goodtalent<span style="color:#4169e1">.OS</span></div>
      <div class="progress-bar-container">
        <div class="progress-bar" id="os-progress"></div>
      </div>
      <div class="loader-text" id="loader-text">Initializing System...</div>
    </div>
  </div>

  <!-- OS Desktop -->
  <div id="os-desktop">
    <!-- Top info bar -->
    <div class="os-topbar">
      <div class="user-profile">
        <div class="user-avatar">NU</div>
        <div class="user-info">
          <span class="user-name">Neo User</span>
          <span class="user-role">Admin</span>
        </div>
      </div>
      <button class="logout-btn">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
          <polyline points="16 17 21 12 16 7"></polyline>
          <line x1="21" y1="12" x2="9" y2="12"></line>
        </svg>
        Logout
      </button>
    </div>

    <!-- Desktop Icons Grid -->
    <div class="desktop-grid" id="desktop-icons">
      <!-- Icons will be injected via JS -->
    </div>

    <!-- Taskbar -->
    <div class="taskbar">
      <button class="start-btn">
        <svg width="32" height="32" viewBox="0 0 24 24" fill="none">
          <path d="M4 4h7v7H4V4zM13 4h7v7h-7V4zM4 13h7v7H4v-7zM13 13h7v7h-7v-7z" fill="#00A4EF" />
        </svg>
      </button>

      <div class="taskbar-apps" id="taskbar-apps">
        <!-- Active windows go here -->
      </div>

      <div class="taskbar-tray">
        <div class="clock" id="os-clock">12:00 PM</div>
      </div>
    </div>
  </div>

  <script type="module" src="/main.js"></script>

  <!-- Background Music -->
  <audio id="bg-music" loop autoplay>
    <source src="./music.mp3" type="audio/mpeg">
  </audio>

  <script>
    // Audio Context Setup
    const AudioContext = window.AudioContext || window.webkitAudioContext;
    const audioCtx = new AudioContext();

    function playTypingSound() {
      // Create a short blip for typing
      const osc = audioCtx.createOscillator();
      const gain = audioCtx.createGain();
      osc.connect(gain);
      gain.connect(audioCtx.destination);

      osc.type = 'square';
      osc.frequency.setValueAtTime(800 + Math.random() * 200, audioCtx.currentTime);
      gain.gain.setValueAtTime(0.05, audioCtx.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.05);

      osc.start();
      osc.stop(audioCtx.currentTime + 0.05);
    }

    function playAccessGrantedSound() {
      // Positive chord
      [440, 554, 659].forEach((freq, i) => {
        setTimeout(() => {
          const osc = audioCtx.createOscillator();
          const gain = audioCtx.createGain();
          osc.connect(gain);
          gain.connect(audioCtx.destination);
          osc.type = 'sawtooth';
          osc.frequency.value = freq;
          gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
          gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 1.0);
          osc.start();
          osc.stop(audioCtx.currentTime + 1.0);
        }, i * 50);
      });
    }


    // Login Handler
    const form = document.getElementById('login-form');
    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      // 1. Fade UI
      document.getElementById('login-content').style.opacity = '0';
      document.getElementById('login-content').style.transition = 'opacity 0.5s';

      // 2. Soft Stop Music
      const music = document.getElementById('bg-music');
      const fadeAudio = setInterval(() => {
        if (music.volume > 0.05) {
          music.volume -= 0.05;
        } else {
          music.pause();
          clearInterval(fadeAudio);
        }
      }, 100);

      // 3. Play Video
      const videoOverlay = document.getElementById('video-overlay');
      const video = document.getElementById('intro-video');

      videoOverlay.style.display = 'block';
      // Force prompt layout
      videoOverlay.offsetHeight;
      videoOverlay.style.opacity = '1';

      video.play();

      // Matrix mode (visual background change)
      if (window.setMatrixMode) window.setMatrixMode(true);

      // 4. Wait for video end or timeout
      // Use a fixed duration or 'ended' event. 
      // The video length is unknown but usually short. Let's listen for 'ended' but also fail-safe.

      const onVideoEnd = async () => {
        videoOverlay.style.opacity = '0';
        await new Promise(r => setTimeout(r, 500));
        videoOverlay.style.display = 'none';

        startOSLoadSequence();
      };

      video.onended = onVideoEnd;
      // Fallback if video fails to play or is too long/short/stuck
      // setTimeout(onVideoEnd, 10000); 
    });

    async function startOSLoadSequence() {
      const loader = document.getElementById('os-loader');
      loader.style.opacity = '1';
      loader.style.pointerEvents = 'auto'; // allow interaction if needed

      // Call Scene Update (Hide Earth, Keep Stars)
      if (window.startOSMode) window.startOSMode();

      // Simulate Loading
      const progressBar = document.getElementById('os-progress');
      const loaderText = document.getElementById('loader-text');
      const steps = ["Loading User Profile...", "Restoring Desktop...", "Fetching Recruiting Data...", "Starting Services...", "Welcome, Neo."];

      for (let i = 0; i <= 100; i += 2) {
        progressBar.style.width = i + '%';
        if (i % 20 === 0 && i < 100) {
          loaderText.innerText = steps[i / 20];
          playTypingSound(); // Reuse sound
        }
        await new Promise(r => setTimeout(r, 30));
      }

      // 6. Redirect to OS App
      await new Promise(r => setTimeout(r, 500));
      window.location.href = '/';
    }

    // Desktop Application Data
    const apps = [
      { name: 'Candidates', icon: 'üë•', color: 'icon-Candidates' },
      { name: 'Job Postings', icon: 'üíº', color: 'icon-Job' },
      { name: 'Interviews', icon: 'üìÖ', color: 'icon-Interviews' },
      { name: 'Analytics', icon: 'üìä', color: 'icon-Analytics' },
      { name: 'Messages', icon: 'üí¨', color: 'icon-Candidates' }, // Reuse class
      { name: 'Settings', icon: '‚öôÔ∏è', color: 'icon-Analytics' }
    ];

    function initDesktop() {
      const grid = document.getElementById('desktop-icons');
      grid.innerHTML = ''; // Clear

      apps.forEach(app => {
        const icon = document.createElement('div');
        icon.className = 'desktop-icon ' + app.color;
        icon.innerHTML = `
          <div class="icon-img">${app.icon}</div>
          <span>${app.name}</span>
        `;
        icon.onclick = () => openWindow(app.name);
        grid.appendChild(icon);
      });

      // Update clock
      setInterval(() => {
        const now = new Date();
        document.getElementById('os-clock').innerText = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
      }, 1000);
    }

    // Window Management System
    let zIndexCounter = 100;

    function openWindow(appName) {
      const desktop = document.getElementById('os-desktop');

      // Create Window DOM
      const win = document.createElement('div');
      win.className = 'os-window';
      win.style.left = (100 + Math.random() * 50) + 'px';
      win.style.top = (50 + Math.random() * 50) + 'px';
      win.style.zIndex = ++zIndexCounter;

      win.innerHTML = `
        <div class="window-header">
          <span class="window-title">${appName}</span>
          <div class="window-controls">
            <button class="win-btn win-min" onclick="minimizeWindow(this)"></button>
            <button class="win-btn win-max"></button>
            <button class="win-btn win-close" onclick="closeWindow(this)"></button>
          </div>
        </div>
        <div class="window-content">
          <h2>${appName}</h2>
          <p>Loading data for ${appName}...</p>
          <div style="margin-top:20px; font-size: 3rem; opacity:0.2;">${apps.find(a => a.name === appName)?.icon || 'üìÅ'}</div>
        </div>
      `;

      // Make Draggable
      const header = win.querySelector('.window-header');
      let isDragging = false;
      let offsetX, offsetY;

      header.addEventListener('mousedown', (e) => {
        isDragging = true;
        offsetX = e.clientX - win.offsetLeft;
        offsetY = e.clientY - win.offsetTop;
        win.style.zIndex = ++zIndexCounter; // Bring to front
      });

      window.addEventListener('mousemove', (e) => {
        if (isDragging) {
          win.style.left = (e.clientX - offsetX) + 'px';
          win.style.top = (e.clientY - offsetY) + 'px';
        }
      });

      window.addEventListener('mouseup', () => {
        isDragging = false;
      });

      win.addEventListener('mousedown', () => {
        win.style.zIndex = ++zIndexCounter;
      });

      desktop.appendChild(win);

      // Add animation
      win.animate([
        { transform: 'scale(0.8)', opacity: 0 },
        { transform: 'scale(1)', opacity: 1 }
      ], { duration: 200, easing: 'ease-out' });

      // Add to Taskbar
      const taskbarApps = document.getElementById('taskbar-apps');
      const taskItem = document.createElement('div');
      taskItem.style.cssText = "padding: 5px 10px; background: rgba(255,255,255,0.1); border-radius: 4px; color: white; font-size: 0.8rem; cursor: pointer;";
      taskItem.innerText = appName;
      taskItem.onclick = () => {
        win.style.display = 'flex';
        win.style.zIndex = ++zIndexCounter;
      };

      // Store ref to remove later? simple hack for now
      win.taskItem = taskItem;
      taskbarApps.appendChild(taskItem);
    }

    window.closeWindow = (btn) => {
      const win = btn.closest('.os-window');
      win.animate([
        { transform: 'scale(1)', opacity: 1 },
        { transform: 'scale(0.8)', opacity: 0 }
      ], { duration: 150 }).onfinish = () => {
        if (win.taskItem) win.taskItem.remove();
        win.remove();
      };
    };

    window.minimizeWindow = (btn) => {
      const win = btn.closest('.os-window');
      win.style.display = 'none';
      // Taskbar item remains
    };

    // Sound Experience Initialization
    document.addEventListener('DOMContentLoaded', () => {
      const overlay = document.getElementById('sound-check-overlay');
      const btn = document.getElementById('sound-ready-btn');
      const audio = document.getElementById('bg-music');
      audio.volume = 0.5;

      // Make button glow on hover
      btn.addEventListener('mouseenter', () => {
        btn.style.boxShadow = '0 0 20px rgba(0, 164, 239, 0.5)';
        btn.style.background = 'rgba(0, 164, 239, 0.1)';
      });
      btn.addEventListener('mouseleave', () => {
        btn.style.boxShadow = 'none';
        btn.style.background = 'transparent';
      });

      btn.addEventListener('click', () => {
        // 1. Resume Audio Context (for sound effects)
        if (audioCtx.state === 'suspended') {
          audioCtx.resume();
        }

        // 2. Play Music
        audio.play().then(() => {
          console.log("Audio initialized successfully");
        }).catch(e => console.error("Audio play failed:", e));

        // 3. Fade out overlay
        overlay.style.transition = 'opacity 1s ease';
        overlay.style.opacity = '0';

        // 4. Remove overlay from DOM
        setTimeout(() => {
          overlay.style.display = 'none';
        }, 1000);
      });
    });

  </script>
</body>

</html>